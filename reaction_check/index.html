<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>反応速度チェックツール</title>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      margin: 20px;
    }
    #target {
      width: 200px;
      height: 200px;
      background-color: #ccc;
      margin: 20px auto;
      display: none;
      cursor: pointer;
      border-radius: 10px;
      transition: background-color 0.3s;
    }
    #startBtn {
      font-size: 1.2em;
      padding: 10px 20px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    #stats {
      margin-top: 20px;
      border-top: 1px solid #999;
      padding-top: 10px;
      display: inline-block;
      text-align: left;
    }
    #info {
      margin: 10px;
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>反応速度チェックツール</h1>
  <p>色が表示されたらすぐにクリックしてください。</p>

  <button id="startBtn">スタート</button>
  <div id="info"></div>
  <div id="target"></div>

  <div id="stats">
    <p>プレイ回数: <span id="count">0</span></p>
    <p>平均反応時間: <span id="average">--</span> ms</p>
  </div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const infoDiv   = document.getElementById('info');
    const targetDiv = document.getElementById('target');
    const countSpan = document.getElementById('count');
    const avgSpan   = document.getElementById('average');

    let clickAllowed = false;
    let startTime = 0;
    let playCount = 0;
    let totalTime = 0;

    const colors = ["red", "blue", "green", "orange", "purple"];

    function getRandomColor() {
      const index = Math.floor(Math.random() * colors.length);
      return colors[index];
    }

    function startGame() {
      infoDiv.textContent = "ランダムなタイミングで色が表示されます。待機してください...";
      targetDiv.style.display = "none";
      clickAllowed = false;

      const waitTime = Math.random() * 3000 + 2000;
      setTimeout(function(){
        const randomColor = getRandomColor();
        targetDiv.style.backgroundColor = randomColor;
        targetDiv.style.display = "block";
        startTime = Date.now();
        clickAllowed = true;
      }, waitTime);
    }

    function updateStats(reactionTime) {
      playCount++;
      totalTime += reactionTime;
      const avgTime = (totalTime / playCount).toFixed(1);
      countSpan.textContent = playCount;
      avgSpan.textContent = avgTime;
    }

    startBtn.addEventListener('click', function() {
      startGame();
    });

    targetDiv.addEventListener('click', function() {
      if(!clickAllowed) return;
      const endTime = Date.now();
      const reactionTime = endTime - startTime;
      infoDiv.textContent = "反応時間: " + reactionTime + " ms";
      targetDiv.style.display = "none";
      clickAllowed = false;

      updateStats(reactionTime);
    });
  </script>
</body>
</html>